# 메모리 관리

# 메모리

## 목표

1. 프로그래밍할때 쉽게 메모리를 사용할 수 있도록 abstraction을 제공하는 것
2. 한정된 자원을 효율적으로 관리해주는 것
3. 프로세스 사이에서 isolation을 제공한다. → 메모리 보호

# 페이징

가상메모리 사용, 외부 단편화 해결, 내부 단편화 존재

보조기억 장치를 이용한 가상메모리를 **같은 크기의 블록**으로 나눈 것을 페이지

- 프로세스를 일정 크기인 페이지로 잘라서 메모리에 적재하는 방식
- 페이지 단위를 작게하면 내부 단편화 문제도 해결할 수 있지만 page mapping 과정이 많아지므로 효율이 떨어질 수 있다.

# 페이지 교체 알고리즘

- FIFO
    - 가장 먼저 들어와서 가장 오래있었던 페이지를 교체하는 기법
    - 각 페이지가 주기억장치에 들어올 때마다 타임 스탬프를 찍어 기억하는 방식
    - 단점: 중요한 페이지가 오랫동안 있었다는 이유만으로 교체되는 불합리
    - Belady의 이상현상 발생
        - 프로세스에 더 많은 수의 페이지 프레임을 할당할 경우 오히려 페이지 부재가 더 많이 발생할 수 있는 현상
- LRU(Least Recently Used)
    - 최근에 가장 오랫동안 사용하지 않은 페이지를 교체하는 기법
    - 각 페이지마다 카운터나 스택을 두어 현 시점에서 가장 오랫동안 사용하지 않은 페이지를 교체함
    - 단점 : 프로세스가 주기억장치에 접근할 때 마다 참조된 페이지에 대한 시간을 기록해야함 ,  큰 오버헤드가 발생
- LFU(Least Frequently Used)
    - 사용 빈도가 가장 적은 페이지를 교체하는 기법
    - 즉, 호출된 횟수가 가장 적은 페이지를 교체
    - 바로 불러온 페이지가 교체될 수 있다는 단점이 존재
    - 단점:
        - 가장 최근에 메모리에 옮겨진 페이지가 교체될 가능성 높음
        - 초기에 매우 많이 사용된 후 더이상 사용되지 않는 페이지는 교체 가능성 낮음
        - 막대한 오버헤드
- NUR(Not Used Recently)
    - LRU와 비슷한 방식으로 최근에 사용하지 않은 페이지를 교체
    - LRU 교체의 단점인 시간 오버헤드를 적게하는 방법
    - 최근 사용여부를 확인하기 위해 각 페이지마다 두 개의 비트(참조, 변형)를 사용

# 세그먼테이션

가상메모리 사용, 내부 단편화 해결, 외부 단편화 존재

- 가상메모리를 **서로 크기가 다른 논리적 단위인 세그먼트로 분할**해서 메모리를 할당하여 실제 메모리 주소로 변환
- 세그먼트 크기가 작을수록 외부 단편화 작음
- 페이징 기법보다 공유 시스템이 간단함
- 보호와 공유에서 효율적

## Paged segmentation

- 세그먼트를 페이징 기법으로 나누는 것
- 세그먼트와 페이지가 동시에 존재하기 때문에 주소 변환도 두 번해야한다. 즉 CPU에서 세그먼트 테이블에서 주소 변환을 하고, 그 다음 페이지 테이블에서 또 주소 변환을 해야한다.

# 가상메모리

가상 메모리는 메모리를 관리하는 방법의 하나로, 각 프로그램에 실제 메모리 주소가 아닌 가상의 메모리 주소를 주는 방식을 말한다.

이러한 방식은 멀티태스킹 운영 체제에서 흔히 사용되며, 실제 주기억장치(RAM)보다 큰 메모리 영역을 제공하는 방법으로 사용된다.

# 단편화

## 외부 단편화

- 총 공간을 계산해봤을 때 요청을 만족할만한 충분한 메모리가 있음에도, 가능한 공간들이 연속적이지 않을 때 (즉 저장공간이 많은 작은 hole들로 조각조각 나있을때) 발생
- 메모리가 할당되고 해제되는 작업이 반복될때 작은 메모리 중간중간에 사용하지 않는 메모리가 많이 존재해서 총 메모리 공간은 충분하지만 실제로 할당할 수 없는 문제

→ compaction 방법으로 해결가능 : 작은 공간들을 모아서 연속적인 공간으로 만드는 작업 비용이 많이든다.

→ 이문제를 해결하는 새로운 방법 paging

## 내부 단편화

- 메모리를 할당할 때 프로세스가 필요한 양보다 더 큰 메모리가 할당되어서 프로세스에서 사용하는 메모리 공간이 낭비 되는 현상

# 스레싱

> 물리 메모리에는 여러 개의 프로세스가 올라와 있다. 운영체제는 물리 메모리의 공간이 충분하면 프로세스의 요청에 따라 원하는 프레임을 할당하지만, 그렇지 않은 경우 남은 프레임을 어떻게 할당할지에 대한 문제가 생긴다.

하드디스크의 입출력이 너무 많아져 잦은 페이지 부재로 CPU Utilzation이 급격히 저하되는 현상

## 원인

- 다중 프로그래밍 정도가 높아짐에 따라 CPU이용률이 높아지게 되고 CPU이용률이 최대값에 도달했을 때 , 다중 프로그래밍의 정도가 그 이상으로 커지게 될때

## 현상 방지

- 각 프로세스가 필요로 하는 최소한의 프레임 갯수를 보장해주어야 합니다.
- 지역교환 알고리즘 : 하나의 프로세스가 스래싱을 발생하게 되더라도 다른 프로세스로부터 프레임을 갖고 올 수 없게 되므로, 다른 프로세스를 스래싱 현상에 빠뜨릴 수 없게 됨
- 우선순위 교환 알고리즘