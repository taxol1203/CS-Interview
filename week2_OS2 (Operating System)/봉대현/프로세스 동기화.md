# 프로세스 동기화

# 정의

- 협력하는 프로세스 사이에서 실행 순서 규칙을 정하여 공유 자원의 일관성을 보장하는 것

✓ 프로세스가 서로 협력하며 공유 자원을 사용하는 상황에서, 경쟁 조건이 발생하면 공유 자원을 신뢰할 수 없게 만들 수 있다. 이를 방지하기 위해 프로세스들이 공유 자원을 사용할 때 특별한 규칙을 만드는 것

## 목적

1. 원하는 결과값을 도출하도록 임계구역 문제를 해결
2. 프로세스의 실행 순서를 원하는 대로 제어
3. Busy wait등과 같은 비효율성 제거

# 임계구역을 해결 조건

- **Mutual exclusion(상호배타)**: 오직 한 쓰레드만이 진입 가능하다. 한 쓰레드가 임계구역에서 수행 중인 상태에서는 다른 쓰레드는 절대 이 구역에 접근할 수 없다.
- **Progress(진행)**: 한 임계구역에 접근하는 쓰레드를 결정하는 것은 유한 시간 이내에 이루어져야한다.
- **Bounded waiting(유한대기)**: 임계구역으로 진입하기 위해 대기하는 모든 쓰레드는 유한 시간 이내에 해당 임계구역으로 진입할 수 있어야 한다.

## 동기화 방법

1. 세마 포어
    - 멀티 프로그래밍 환경에서 공유 자원(임계구역)에 대한 접근을 제한하는 방법
2. Mutex(상호배제)
    - lock을 가진 스레드만이 임계구역에 접근할 수 있다.
    - 임계구역에서 작업이 끝난 스레드는 Unlock하여  lock반환

- 뮤텍스와 세마포어의 차이
    - 우리(프로세스), 방(자원)
    - 뮤텍스 : 방에 들어가기 위한 열쇠의 개수
        - 한 사람이 빈 방에 대한 열쇠를 가지고 들어가면 다른 사람은 그 사람이 나와야 들어갈 수 있다,
    - 세마포어는 빈 방의 열쇠의 개수
        - 방이 네개면 열쇠도 네개.. 아무나 먼저 나와야만 방과 열쇠를 한개씩  얻어 들어갈 수 있음.
1. 모니터

    `Q. 뮤텍스와 모니터의 차이는?`

    - 가장 큰 차이는 **뮤텍스**는 **다른 프로세스**(애플리케이션) 간에 동기화를 위해 사용한다. 반면에 **모니터**는 하나의 프로세스(애플리케이션)내에 **다른 쓰레드들 간**에 동기화를 위해 사용한다.
    - 또한, 뮤텍스는 보통 운영체제 커널에 의해서 제공되는 반면에 모니터는 프레임워크나 라이브러리 그 자체에서 제공된다.
    - 따라서 뮤텍스는 무겁고(heavy-weight) 느리며(slower) 모니터는 가볍고(light-weight) 빠르다(faster).

# 교착 상태 (데드락)

💭자원이 한정되어 있어서 상대방이 자원을 다 쓰고 돌려줄 때까지 기다리다가 그걸 받아서 쓴다고 한다. 근데 그걸 서로가 기다려서 영원히 무한 기다림에 빠져 버리는 것

- 한정된 자원을 여러 곳에서 사용하려고 할 때 발생할 수 있다.
- 프로세스가 자원을 얻지 못해 다음 처리를 하지 못하는 상태

[네가지 조건이 동시에 성립할 때 발생](https://www.notion.so/20d5d1edf4b64fc8a39dce77400f01b8)

## 데드락 처리

1. 교착 상태 예방 및 회피 : 교착 상태가 되지 않도록 보장하기 위하여 교착 상태를 예방하거나 회피하는 프로토콜을 이용하는 방법
2. 교창 상태 탐지 및 회복 : 교착 상태가 되도록 허용한 다음에 회복시키는 방법
3. 교착 상태 무시 : 대부분의 시스템은 교착 상태가 잘 발생하지 않으며, 교착 상태 예방, 회피, 탐지, 복구하는 것은 비용이 많이 든다.

# 용어

- 경쟁 조건 : 여러 프로세스(스레드) 가 공유 자원에 동시에 접근할 때, 공유 자원에 대한 접근 순서에 따라 실행 결과가 달라질 수 있는 상황
- 임계 구역 : 여러 프로세스(스레드)가 자원을 공유하는 상황에서 하나의 프로세스만 접근할수 있도록 제한해둔 코드 영역
- busy waiting : 생산과 소비하기 전에 버퍼가 가득 찼는지 비어 있는지 확인하는 무한 반복문